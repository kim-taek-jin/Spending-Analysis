<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ ì§€ì¶œ ë¶„ì„</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 650px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        h1 {
            text-align: center;
            color: #444;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .card {
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        h3 {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #555;
            border-left: 4px solid #4a90e2;
            padding-left: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #666;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background: #f9f9f9;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 5px rgba(74, 144, 226, 0.2);
        }
        
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: #f9f9f9 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23666" class="bi bi-caret-down-fill" viewBox="0 0 16 16"><path d="M7.247 11.14c-.16.16-.408.16-.567 0L.19 5.924C.03 5.764-.002 5.626.03 5.484c.032-.142.14-.24.275-.275l7.152-.715c.135-.015.26.02.39.11l.035.035c.13.09.23.23.23.365z"/></svg>') no-repeat right 15px center;
            background-size: 12px;
        }

        .btn {
            background: linear-gradient(135deg, #4a90e2 0%, #764ba2 100%);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.3);
        }

        .total-section {
            background: linear-gradient(135deg, #4a90e2 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .total-amount {
            font-size: 2.2em;
            font-weight: 700;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        .expense-item {
            background: #f9f9f9;
            padding: 18px;
            border-radius: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeIn 0.5s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .expense-item:hover {
            transform: scale(1.02);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .expense-info {
            flex-grow: 1;
        }

        .expense-category {
            font-weight: 600;
            color: #4a90e2;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .expense-description {
            color: #888;
            font-size: 14px;
        }

        .expense-amount {
            font-size: 1.2em;
            font-weight: 700;
            color: #e74c3c;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 15px;
            transition: background 0.2s;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .category-emoji {
            font-size: 1.2em;
        }

        /* Stats Section */
        .stats-section {
            padding: 30px;
        }

        .stats-tabs {
            display: flex;
            background: #f0f4f7;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 25px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            color: #666;
            font-size: 15px;
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #4a90e2, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        .tab-btn:hover:not(.active) {
            background: #e0e6ec;
        }
        
        .chart-container {
            height: 300px;
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }

        .category-stats {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .category-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95em;
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category-amount {
            font-weight: 700;
            color: #333;
        }
        
        /* New summary styles */
        .period-summary {
            display: flex;
            flex-direction: column;
            padding: 25px;
            border-radius: 20px;
            background: linear-gradient(135deg, #4a90e2 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .period-summary:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .period-date {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .summary-main {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-total {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .summary-main .icon {
            font-size: 2.5em;
        }

        .amount-group {
            display: flex;
            flex-direction: column;
        }

        .amount-group .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .amount-group .value {
            font-size: 2.5em;
            font-weight: 700;
            line-height: 1.2;
        }

        .summary-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding-top: 20px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .detail-item .icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .detail-label {
            font-size: 0.8em;
            opacity: 0.9;
            margin-bottom: 3px;
        }

        .detail-value {
            font-size: 1.2em;
            font-weight: 700;
        }


        /* Budget Section */
        .budget-section .budget-btn {
            background: linear-gradient(135deg, #34d399 0%, #20c997 100%);
        }

        .budget-section .budget-btn:hover {
            box-shadow: 0 8px 20px rgba(52, 211, 153, 0.3);
        }

        .budget-status {
            background: #f0f7ff;
            border-left: 5px solid #4a90e2;
            padding: 25px;
            border-radius: 15px;
        }

        .budget-status.over-budget {
            background: #fff0f0;
            border-left-color: #e74c3c;
        }

        .budget-progress {
            background: #e9ecef;
            height: 12px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .budget-progress-bar {
            background: #4a90e2;
            border-radius: 6px;
        }

        .budget-progress-bar.over-budget {
            background: #e74c3c;
        }
        
        .budget-info-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .budget-info-item {
            padding: 12px;
            background: #fafafa;
            border-radius: 10px;
        }
        
        .positive { color: #2ecc71; }
        .negative { color: #e74c3c; }

        /* Data Section */
        .data-section {
            padding: 30px;
        }
        
        .data-buttons {
            gap: 10px;
            grid-template-columns: repeat(2, 1fr);
        }
        
        .data-btn {
            font-size: 14px;
            padding: 10px;
            border-radius: 10px;
        }

        .data-btn.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .data-btn.success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }
        
        .data-btn.info {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        .save-status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 10px;
            font-size: 14px;
            text-align: center;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .save-status.error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .stats-content {
            display: none;
        }

        .stats-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ë‚˜ì˜ ì§€ì¶œ ë¶„ì„</h1>
        
        <div class="card input-section">
            <h3>ì§€ì¶œ ê¸°ë¡í•˜ê¸°</h3>
            <div class="form-group">
                <label for="amount">ê¸ˆì•¡</label>
                <input type="number" id="amount" placeholder="ì˜ˆ: 10000">
            </div>
            
            <div class="form-group">
                <label for="category">ì¹´í…Œê³ ë¦¬</label>
                <select id="category">
                    <option value="ì‹ë¹„">ğŸ” ì‹ë¹„</option>
                    <option value="êµí†µ">ğŸšŒ êµí†µ</option>
                    <option value="í•™ì—…">ğŸ“š í•™ì—…</option>
                    <option value="ì‡¼í•‘">ğŸ›ï¸ ì‡¼í•‘</option>
                    <option value="ë™ì•„ë¦¬">ğŸª ë™ì•„ë¦¬</option>
                    <option value="ì¹´í˜">â˜• ì¹´í˜</option>
                    <option value="ë¯¸ìš©">ğŸ’„ ë¯¸ìš©</option>
                    <option value="ì˜ë£Œ">ğŸ¥ ì˜ë£Œ</option>
                    <option value="ìš´ë™">ğŸ’ª ìš´ë™</option>
                    <option value="íˆ¬ì">ğŸ“ˆ íˆ¬ì</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="description">ë‚´ìš©</label>
                <input type="text" id="description" placeholder="ì˜ˆ: ì ì‹¬ ì‹ì‚¬">
            </div>
            
            <button class="btn" onclick="addExpense()">ì§€ì¶œ ì¶”ê°€í•˜ê¸°</button>
        </div>

        <div class="total-section">
            <h3>ì´ë²ˆ ë‹¬ ì´ ì§€ì¶œ</h3>
            <div class="total-amount" id="totalAmount">0ì›</div>
        </div>

        <div class="card budget-section">
            <h3>ğŸ’° ì›” ì˜ˆì‚° ì„¤ì •</h3>
            <div class="budget-input-group">
                <input type="number" id="budgetInput" class="budget-input" placeholder="ì›” ì˜ˆì‚° ì…ë ¥ (ì˜ˆ: 500000)">
                <button class="budget-btn" onclick="setBudget()">ì„¤ì •</button>
            </div>
        </div>

        <div class="card data-section">
            <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
            <div id="saveStatus" class="save-status" style="display: none;"></div>
            <div class="data-buttons">
                <button class="data-btn info" onclick="exportData()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
                <button class="data-btn info" onclick="document.getElementById('fileInput').click()">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
                <button class="data-btn danger" onclick="clearAllData()">ğŸ—‘ï¸ ëª¨ë‘ ì‚­ì œ</button>
                <button class="data-btn success" onclick="saveToStorage()">ğŸ’¾ ìˆ˜ë™ ì €ì¥</button>
            </div>
            <input type="file" id="fileInput" class="file-input" accept=".json" onchange="importData(event)">
        </div>

        <div id="budgetStatus" class="card budget-status" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 id="budgetTitle" style="margin: 0; font-size: 1.1em; color: #444;">ì˜ˆì‚° í˜„í™©</h4>
                <button class="budget-btn" id="budgetEditBtn" style="font-size: 12px; padding: 8px 12px; background: #6c757d;">ì˜ˆì‚° ìˆ˜ì •</button>
            </div>
            
            <div id="budgetEditForm" class="budget-input-group" style="display: none; margin-bottom: 15px;">
                <input type="number" id="budgetEditInput" class="budget-input" placeholder="ìƒˆ ì˜ˆì‚° ì…ë ¥">
                <button class="budget-btn" id="updateBudgetBtn">ìˆ˜ì •</button>
                <button class="budget-btn" id="cancelBudgetBtn" style="background: #e74c3c;">ì·¨ì†Œ</button>
            </div>
            
            <div class="budget-progress">
                <div class="budget-progress-bar" id="budgetProgressBar"></div>
            </div>
            
            <div class="budget-info-grid">
                <div class="budget-info-item">
                    <div class="budget-info-value" id="budgetUsage">0%</div>
                    <div class="budget-info-label">ì‚¬ìš©ë¥ </div>
                </div>
                <div class="budget-info-item">
                    <div class="budget-info-value" id="budgetRemaining">0ì›</div>
                    <div class="budget-info-label">ë‚¨ì€ ì˜ˆì‚°</div>
                </div>
                <div class="budget-info-item">
                    <div class="budget-info-value" id="dailyRecommend">0ì›</div>
                    <div class="budget-info-label">ì¼ì¼ ê¶Œì¥</div>
                </div>
                <div class="budget-info-item">
                    <div class="budget-info-value" id="monthlyBudget">0ì›</div>
                    <div class="budget-info-label">ì„¤ì • ì˜ˆì‚°</div>
                </div>
            </div>
        </div>

        <div class="card expense-list">
            <h3>ğŸ“ ì§€ì¶œ ë‚´ì—­</h3>
            <div class="sort-section" style="text-align: right; margin-bottom: 15px;">
                <label for="sortOrder" style="font-size: 0.9em; color: #777;">ì •ë ¬ ê¸°ì¤€:</label>
                <select id="sortOrder" onchange="sortExpenses()">
                    <option value="dateDesc">ë‚ ì§œ (ìµœì‹ ìˆœ)</option>
                    <option value="amountDesc">ê¸ˆì•¡ (ë†’ì€ ìˆœ)</option>
                    <option value="categoryAsc">ì¹´í…Œê³ ë¦¬ (ê°€ë‚˜ë‹¤ìˆœ)</option>
                </select>
            </div>
            <div id="expenseItems"></div>
        </div>

        <div class="card stats-section">
            <h3>ğŸ“Š ì§€ì¶œ í†µê³„</h3>
            
            <div class="stats-tabs">
                <button class="tab-btn active" onclick="switchTab('weekly')">ì£¼ê°„ í†µê³„</button>
                <button class="tab-btn" onclick="switchTab('monthly')">ì›”ê°„ í†µê³„</button>
            </div>

            <div id="weekly-stats" class="stats-content active">
                <div class="period-summary">
                    <div class="summary-header">
                        <h4 style="margin: 0;">ì´ë²ˆ ì£¼ ì§€ì¶œ í˜„í™©</h4>
                        <span class="period-date" id="weeklyPeriod"></span>
                    </div>
                    <div class="summary-main">
                        <div class="summary-total">
                            <span class="icon">ğŸ’¸</span>
                            <div class="amount-group">
                                <div class="label">ì´ ì§€ì¶œ</div>
                                <div class="value" id="weeklyTotal">0ì›</div>
                            </div>
                        </div>
                    </div>
                    <div class="summary-details">
                        <div class="detail-item">
                            <span class="icon">â˜€ï¸</span>
                            <div class="detail-label">ì¼í‰ê· </div>
                            <div class="detail-value" id="weeklyAvg">0ì›</div>
                        </div>
                        <div class="detail-item">
                            <span class="icon">ğŸ“„</span>
                            <div class="detail-label">ì§€ì¶œ ê±´ìˆ˜</div>
                            <div class="detail-value" id="weeklyCount">0ê±´</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
                
                <div class="category-stats" id="weeklyCategoryStats"></div>
            </div>

            <div id="monthly-stats" class="stats-content">
                <div class="period-summary">
                    <div class="summary-header">
                        <h4 style="margin: 0;">ì´ë²ˆ ë‹¬ ì§€ì¶œ í˜„í™©</h4>
                        <span class="period-date" id="monthlyPeriod"></span>
                    </div>
                    <div class="summary-main">
                        <div class="summary-total">
                            <span class="icon">ğŸ’¸</span>
                            <div class="amount-group">
                                <div class="label">ì´ ì§€ì¶œ</div>
                                <div class="value" id="monthlyTotal">0ì›</div>
                            </div>
                        </div>
                    </div>
                    <div class="summary-details">
                        <div class="detail-item">
                            <span class="icon">â˜€ï¸</span>
                            <div class="detail-label">ì¼í‰ê· </div>
                            <div class="detail-value" id="monthlyAvg">0ì›</div>
                        </div>
                        <div class="detail-item">
                            <span class="icon">ğŸ“„</span>
                            <div class="detail-label">ì§€ì¶œ ê±´ìˆ˜</div>
                            <div class="detail-value" id="monthlyCount">0ê±´</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
                
                <div class="category-stats" id="monthlyCategoryStats"></div>
            </div>
        </div>
    </div>

    <script>
        // ì§€ì¶œ ë°ì´í„°ë¥¼ ì €ì¥í•  ë°°ì—´
        let expenses = [];
        let weeklyChart = null;
        let monthlyChart = null;
        let monthlyBudget = 0; // ì›” ì˜ˆì‚°

        // ì¹´í…Œê³ ë¦¬ë³„ ì´ëª¨ì§€ ë§¤í•‘
        const categoryEmojis = {
            'ì‹ë¹„': 'ğŸ”',
            'êµí†µ': 'ğŸšŒ',
            'í•™ì—…': 'ğŸ“š',
            'ì‡¼í•‘': 'ğŸ›ï¸',
            'ë™ì•„ë¦¬': 'ğŸª',
            'ì¹´í˜': 'â˜•',
            'ë¯¸ìš©': 'ğŸ’„',
            'ì˜ë£Œ': 'ğŸ¥',
            'ìš´ë™': 'ğŸ’ª',
            'íˆ¬ì': 'ğŸ“ˆ'
        };

        // ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ ë§¤í•‘
        const categoryColors = {
            'ì‹ë¹„': '#FF6384',
            'êµí†µ': '#36A2EB',
            'í•™ì—…': '#FFCE56',
            'ì‡¼í•‘': '#9966FF',
            'ë™ì•„ë¦¬': '#4BC0C0',
            'ì¹´í˜': '#FF6384',
            'ë¯¸ìš©': '#C9CBCF',
            'ì˜ë£Œ': '#FF6384',
            'ìš´ë™': '#4BC0C0',
            'íˆ¬ì': '#00D2FF'
        };

        // ì§€ì¶œ ì¶”ê°€ í•¨ìˆ˜
        function addExpense() {
            const amount = document.getElementById('amount').value;
            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value;

            // ì…ë ¥ê°’ í™•ì¸
            if (!amount || amount <= 0) {
                alert('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            if (!description.trim()) {
                alert('ì§€ì¶œ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            // ìƒˆë¡œìš´ ì§€ì¶œ ê°ì²´ ìƒì„±
            const newExpense = {
                id: Date.now(), // ê°„ë‹¨í•œ ID ìƒì„±
                amount: parseInt(amount),
                category: category,
                description: description.trim(),
                date: new Date().toLocaleDateString(),
                dateObj: new Date() // ë‚ ì§œ ê³„ì‚°ìš©
            };

            // ë°°ì—´ì— ì¶”ê°€
            expenses.push(newExpense);

            // í™”ë©´ ì—…ë°ì´íŠ¸
            sortExpenses();
            updateTotal();
            updateStats();
            updateBudgetStatus();
            saveToStorage(); // ìë™ ì €ì¥

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
        }

        // ì§€ì¶œ ë‚´ì—­ í™”ë©´ì— í‘œì‹œ
        function displayExpenses() {
            const container = document.getElementById('expenseItems');
            container.innerHTML = '';

            expenses.forEach(expense => {
                const expenseDiv = document.createElement('div');
                expenseDiv.className = 'expense-item';
                
                expenseDiv.innerHTML = `
                    <div class="expense-info">
                        <div class="expense-category">
                            <span class="category-emoji">${categoryEmojis[expense.category]}</span>
                            ${expense.category}
                        </div>
                        <div class="expense-description">${expense.description} | ${expense.date}</div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div class="expense-amount">${expense.amount.toLocaleString()}ì›</div>
                        <button class="delete-btn" onclick="deleteExpense(${expense.id})">ì‚­ì œ</button>
                    </div>
                `;
                
                container.appendChild(expenseDiv);
            });
        }

        // ì§€ì¶œ ì‚­ì œ
        function deleteExpense(id) {
            expenses = expenses.filter(expense => expense.id !== id);
            sortExpenses();
            updateTotal();
            updateStats();
            updateBudgetStatus();
            saveToStorage(); // ìë™ ì €ì¥
        }

        // ì§€ì¶œ ë‚´ì—­ ì •ë ¬ í•¨ìˆ˜
        function sortExpenses() {
            const sortOrder = document.getElementById('sortOrder').value;

            switch (sortOrder) {
                case 'dateDesc':
                    expenses.sort((a, b) => b.dateObj - a.dateObj);
                    break;
                case 'amountDesc':
                    expenses.sort((a, b) => b.amount - a.amount);
                    break;
                case 'categoryAsc':
                    expenses.sort((a, b) => a.category.localeCompare(b.category));
                    break;
                default:
                    break;
            }
            displayExpenses();
        }

        // ì´ì•¡ ì—…ë°ì´íŠ¸
        function updateTotal() {
            const total = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            document.getElementById('totalAmount').textContent = total.toLocaleString() + 'ì›';
        }

        // Enter í‚¤ë¡œ ì¶”ê°€ ê°€ëŠ¥í•˜ê²Œ
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addExpense();
            }
        });

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tab) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.stats-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.querySelector(`.tab-btn[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(tab + '-stats').classList.add('active');
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateStats();
        }

        // ì£¼ê°„/ì›”ê°„ ë°ì´í„° í•„í„°ë§
        function getWeeklyExpenses() {
            const now = new Date();
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            weekStart.setHours(0, 0, 0, 0);
            
            return expenses.filter(expense => expense.dateObj >= weekStart);
        }

        function getMonthlyExpenses() {
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            
            return expenses.filter(expense => expense.dateObj >= monthStart);
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ê³„ì‚°
        function getCategoryStats(expenseList) {
            const categoryStats = {};
            
            expenseList.forEach(expense => {
                if (!categoryStats[expense.category]) {
                    categoryStats[expense.category] = {
                        total: 0,
                        count: 0
                    };
                }
                categoryStats[expense.category].total += expense.amount;
                categoryStats[expense.category].count += 1;
            });
            
            return categoryStats;
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            updateWeeklyStats();
            updateMonthlyStats();
        }

        function updateWeeklyStats() {
            const weeklyExpenses = getWeeklyExpenses();
            const total = weeklyExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const count = weeklyExpenses.length;
            const avg = count > 0 ? Math.round(total / 7) : 0;
            
            const now = new Date();
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            const weekEnd = new Date(now);
            weekEnd.setDate(now.getDate() + (6 - now.getDay()));
            
            const periodSpan = document.getElementById('weeklyPeriod');
            periodSpan.textContent = `${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;

            document.getElementById('weeklyTotal').textContent = total.toLocaleString() + 'ì›';
            document.getElementById('weeklyAvg').textContent = avg.toLocaleString() + 'ì›';
            document.getElementById('weeklyCount').textContent = count + 'ê±´';
            
            const categoryStats = getCategoryStats(weeklyExpenses);
            displayCategoryStats('weeklyCategoryStats', categoryStats);
            
            updateChart('weeklyChart', categoryStats, 'weekly');
        }

        function updateMonthlyStats() {
            const monthlyExpenses = getMonthlyExpenses();
            const total = monthlyExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const count = monthlyExpenses.length;
            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const avg = count > 0 ? Math.round(total / daysInMonth) : 0;

            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            const monthFormatter = new Intl.DateTimeFormat('ko-KR', { month: 'long' });
            const periodSpan = document.getElementById('monthlyPeriod');
            periodSpan.textContent = `${monthFormatter.format(monthStart)} (${monthStart.getDate()}ì¼ - ${monthEnd.getDate()}ì¼)`;
            
            document.getElementById('monthlyTotal').textContent = total.toLocaleString() + 'ì›';
            document.getElementById('monthlyAvg').textContent = avg.toLocaleString() + 'ì›';
            document.getElementById('monthlyCount').textContent = count + 'ê±´';
            
            const categoryStats = getCategoryStats(monthlyExpenses);
            displayCategoryStats('monthlyCategoryStats', categoryStats);
            
            updateChart('monthlyChart', categoryStats, 'monthly');
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ í‘œì‹œ
        function displayCategoryStats(containerId, categoryStats) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const sortedCategories = Object.entries(categoryStats)
                .sort(([,a], [,b]) => b.total - a.total);
            
            sortedCategories.forEach(([category, stats]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-item';
                
                categoryDiv.innerHTML = `
                    <div class="category-info">
                        <span class="category-emoji">${categoryEmojis[category]}</span>
                        <div>
                            <div style="font-weight: 600; color: #333;">${category}</div>
                            <div style="font-size: 12px; color: #666;">${stats.count}ê±´</div>
                        </div>
                    </div>
                    <div class="category-amount">${stats.total.toLocaleString()}ì›</div>
                `;
                
                container.appendChild(categoryDiv);
            });
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateChart(chartId, categoryStats, period) {
            const ctx = document.getElementById(chartId).getContext('2d');
            
            if (period === 'weekly' && weeklyChart) {
                weeklyChart.destroy();
            } else if (period === 'monthly' && monthlyChart) {
                monthlyChart.destroy();
            }
            
            const categories = Object.keys(categoryStats);
            const amounts = Object.values(categoryStats).map(stat => stat.total);
            const colors = categories.map(category => categoryColors[category] || '#999999');
            
            if (categories.length === 0) {
                return;
            }
            
            const chartConfig = {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: amounts,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            };
            
            const chart = new Chart(ctx, chartConfig);
            
            if (period === 'weekly') {
                weeklyChart = chart;
            } else {
                monthlyChart = chart;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í†µê³„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            sortExpenses();
            updateStats();
            
            document.getElementById('budgetEditBtn').addEventListener('click', showBudgetEdit);
            document.getElementById('updateBudgetBtn').addEventListener('click', updateBudget);
            document.getElementById('cancelBudgetBtn').addEventListener('click', cancelBudgetEdit);
            
            document.getElementById('budgetEditInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    updateBudget();
                }
            });
        });

        // === ë°ì´í„° ì €ì¥/ë¡œë“œ ê¸°ëŠ¥ ===
        
        function saveToStorage() {
            const data = {
                expenses: expenses,
                monthlyBudget: monthlyBudget,
                lastSaved: new Date().toISOString()
            };
            
            try {
                const jsonData = JSON.stringify(data);
                localStorage.setItem('expenseTrackerData', jsonData);
                showSaveStatus('ë°ì´í„°ê°€ ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (error) {
                showSaveStatus('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        function loadFromStorage() {
            try {
                const savedData = localStorage.getItem('expenseTrackerData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    expenses = data.expenses.map(expense => ({
                        ...expense,
                        dateObj: new Date(expense.dateObj || expense.date)
                    }));
                    
                    monthlyBudget = data.monthlyBudget || 0;
                    
                    displayExpenses();
                    updateTotal();
                    
                    if (monthlyBudget > 0) {
                        document.getElementById('budgetStatus').style.display = 'block';
                        updateBudgetStatus();
                    }
                    
                    if (expenses.length > 0) {
                        showSaveStatus(`ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. (ì§€ì¶œ ${expenses.length}ê±´)`, 'success');
                    }
                }
            } catch (error) {
                showSaveStatus('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                console.error('ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        function exportData() {
            const data = {
                expenses: expenses,
                monthlyBudget: monthlyBudget,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ì§€ì¶œë¶„ì„_ë°±ì—…_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSaveStatus('ë°ì´í„°ê°€ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.expenses || !Array.isArray(data.expenses)) {
                        throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
                    }
                    
                    const confirmImport = confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê³  ìƒˆ ë°ì´í„°ë¡œ êµì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (!confirmImport) return;
                    
                    expenses = data.expenses.map(expense => ({
                        ...expense,
                        dateObj: new Date(expense.dateObj || expense.date)
                    }));
                    
                    monthlyBudget = data.monthlyBudget || 0;
                    
                    sortExpenses();
                    updateTotal();
                    updateStats();
                    
                    if (monthlyBudget > 0) {
                        document.getElementById('budgetStatus').style.display = 'block';
                        updateBudgetStatus();
                    }
                    
                    saveToStorage();
                    showSaveStatus(`ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. (ì§€ì¶œ ${expenses.length}ê±´)`, 'success');
                    
                } catch (error) {
                    showSaveStatus('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                    console.error('ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        function clearAllData() {
            const confirmDelete = confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            if (!confirmDelete) return;
            
            const confirmAgain = confirm('ë§ˆì§€ë§‰ í™•ì¸: ëª¨ë“  ì§€ì¶œ ê¸°ë¡ê³¼ ì˜ˆì‚° ì„¤ì •ì´ ì‚­ì œë©ë‹ˆë‹¤.');
            if (!confirmAgain) return;
            
            expenses = [];
            monthlyBudget = 0;
            
            localStorage.removeItem('expenseTrackerData');
            
            displayExpenses();
            updateTotal();
            updateStats();
            document.getElementById('budgetStatus').style.display = 'none';
            
            showSaveStatus('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function showSaveStatus(message, type = 'success') {
            const statusDiv = document.getElementById('saveStatus');
            statusDiv.textContent = message;
            statusDiv.className = `save-status ${type}`;
            
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        function setBudget() {
            const budgetInput = document.getElementById('budgetInput');
            const budget = parseInt(budgetInput.value);

            if (!budget || budget <= 0) {
                alert('ì˜¬ë°”ë¥¸ ì˜ˆì‚° ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            monthlyBudget = budget;
            budgetInput.value = '';
            
            document.getElementById('budgetStatus').style.display = 'block';
            updateBudgetStatus();
            saveToStorage();
        }

        function updateBudgetStatus() {
            if (monthlyBudget === 0) return;

            const monthlyExpenses = getMonthlyExpenses();
            const totalSpent = monthlyExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            const usagePercent = Math.round((totalSpent / monthlyBudget) * 100);
            const remaining = monthlyBudget - totalSpent;
            
            const now = new Date();
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const remainingDays = lastDay - now.getDate() + 1;
            
            const dailyRecommend = remaining > 0 && remainingDays > 0 ? Math.round(remaining / remainingDays) : 0;
            
            const budgetStatus = document.getElementById('budgetStatus');
            const progressBar = document.getElementById('budgetProgressBar');
            const budgetTitle = document.getElementById('budgetTitle');
            
            if (usagePercent > 100) {
                budgetStatus.classList.add('over-budget');
                progressBar.classList.add('over-budget');
                budgetTitle.textContent = `ì˜ˆì‚° ${usagePercent - 100}% ì´ˆê³¼! ğŸ˜±`;
            } else {
                budgetStatus.classList.remove('over-budget');
                progressBar.classList.remove('over-budget');
                budgetTitle.textContent = 'ì˜ˆì‚° í˜„í™© ğŸ“Š';
            }
            
            const progressWidth = Math.min(usagePercent, 100);
            progressBar.style.width = progressWidth + '%';
            
            document.getElementById('budgetUsage').textContent = usagePercent + '%';
            document.getElementById('budgetUsage').className = 'budget-info-value ' + (usagePercent > 100 ? 'negative' : 'positive');
            
            document.getElementById('budgetRemaining').textContent = remaining.toLocaleString() + 'ì›';
            document.getElementById('budgetRemaining').className = 'budget-info-value ' + (remaining < 0 ? 'negative' : 'positive');
            
            document.getElementById('dailyRecommend').textContent = dailyRecommend.toLocaleString() + 'ì›';
            document.getElementById('dailyRecommend').className = 'budget-info-value ' + (dailyRecommend < 0 ? 'negative' : 'positive');
            
            document.getElementById('monthlyBudget').textContent = monthlyBudget.toLocaleString() + 'ì›';
        }

        function showBudgetEdit() {
            const editForm = document.getElementById('budgetEditForm');
            const editInput = document.getElementById('budgetEditInput');
            
            editForm.style.display = 'flex';
            editInput.value = monthlyBudget;
            editInput.focus();
        }

        function cancelBudgetEdit() {
            const editForm = document.getElementById('budgetEditForm');
            const editInput = document.getElementById('budgetEditInput');
            
            editForm.style.display = 'none';
            editInput.value = '';
        }

        function updateBudget() {
            const editInput = document.getElementById('budgetEditInput');
            const newBudget = parseInt(editInput.value);

            if (!newBudget || newBudget <= 0) {
                alert('ì˜¬ë°”ë¥¸ ì˜ˆì‚° ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            monthlyBudget = newBudget;
            
            cancelBudgetEdit();
            
            updateBudgetStatus();
            saveToStorage();
            
            alert('ì˜ˆì‚°ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
    </script>
</body>
</html>
